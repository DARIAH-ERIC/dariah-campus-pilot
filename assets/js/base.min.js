/*------------------------------------------------------------------------------
    JS Document (https://developer.mozilla.org/en/JavaScript)

    project:    Dariah Winter School
    created:    2016-12-05
    author:     Christophe ANDRIEU (http://www.stpo.fr)
----------------------------------------------------------------------------- */
!function(f,e){f.noConflict();var u=document,h=window,d={};f(u).ready(function(){d.popin(),d.svg(),d.showHide(),d.scrollTo(),d.email(),d.iframeResize()}),f(h).load(function(){d.stickyAnchors(),d.stickyPosition(),d.stickyDisplay()}),f.extend(f.easing,{def:"easeOutExpo",easeOutExpo:function(e,t,o,n,i){return t==i?o+n:n*(1-Math.pow(2,-10*t/i))+o}}),d.pxValue=function(e){return e*parseFloat(f("body").css("font-size"))},d.onElementHeightChange=function(t,o){var n,i=t.clientHeight;!function e(){n=t.clientHeight,i!=n&&o(),i=n,t.onElementHeightChangeTimer&&clearTimeout(t.onElementHeightChangeTimer),t.onElementHeightChangeTimer=setTimeout(e,200)}()},d.svg=function(){document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")||f(".img-svg").each(function(e){f(this).attr("src",f(this).attr("src").replace(".svg",".png"))})},d.showHide=function(){f("body");f(".show-hide").each(function(){var t=f(this),o=f(t.data("target")),n=t.closest(".show-hide-collection");0==o.length&&(o=t.prev(".show-hide-target").add(t.next(".show-hide-target")));var e=o.find(".show-hide-close").not(o.find(".show-hide-target .show-hide-close")),i=o.find("a, button");t.add(o).not(".default-active").removeClass("active"),t.hasClass("default-active")||i.attr("taonex","-1"),t.add(e).off("click").on("click",function(e){return o.hasClass("active")?(t.add(o).removeClass("active"),i.attr("taonex","-1")):(t.add(o).addClass("active"),i.attr("taonex","0"),0!=n.length&&n.find(".show-hide.active").not(t).trigger("click")),t.blur(),!1})})},d.scrollTo=function(){var o=f("html, body"),n=f(".link-scroll-to-anchor");n.each(function(){var e=f(this),t=e.attr("href");e.on("click",function(){return n.filter(".active").removeClass("active"),e.addClass("active"),o.stop().animate({scrollTop:f(t).offset().top},1e3,"easeOutExpo",function(){}),e.blur(),!1})})},d.email=function(){f(".email").each(function(e){var t=f(this),o=t.find("span"),n="",i=t.data("title");0<o.length&&(n=o[0].outerHTML+" ",o.remove());var s=t.html().replace(/\s/g,""),a=s.split("[AT]")[0]+"@"+s.split("[AT]")[1].split("[DOT]")[0]+"."+s.split("[AT]")[1].split("[DOT]")[1];null==i&&(i=a),t.html('<a href="mailto:'+a+'">'+n+i+"</a>")})},d.iframeResize=function(){f(".iframe-container").each(function(){var e=f(this),t=e.find("iframe"),o=parseInt(t.attr("height"))/parseInt(t.attr("width"))*100;e.css("padding-bottom",o+"%")})},d.stickyAnchors=function(){if(0==document.getElementsByClassName("sticky-anchors").length)return!1;var e=f(".sticky-anchors"),o=parseInt(e.data("margin-top")),n=e.find(".sticky-anchors-link"),s=f("html, body"),t=[],a=[],c=f(u).height(),r=function(){for(t=[],a=[],n.each(function(){var e=f(this).attr("href");t.push(parseInt(f(e).offset().top))}),i=0;i<n.length;i++)i==n.length-1?a.push([t[i],c]):a.push([t[i],t[i+1]])},l=function(){var e=f(window).scrollTop()+1+d.pxValue(o);for(var t in a)parseInt(a[t][0])<parseInt(e)&&parseInt(e)<parseInt(a[t][1])&&(n.filter(".active").removeClass("active"),n.eq(t).addClass("active"))};n.add(".internal-link").each(function(){var e=f(this),t=e.attr("href");e.on("click",function(){return n.removeClass("focus"),e.addClass("focus"),s.stop().animate({scrollTop:f(t).offset().top-d.pxValue(o)},1e3,"easeOutExpo",function(){e.removeClass("focus")}),e.blur(),!1})}),f(h).on("resize",f.debounce(100,r)),r(),f(h).on("resize",f.debounce(100,l)),f(u).on("scroll",f.debounce(10,l)),l(),d.onElementHeightChange(document.body,function(){r()})},d.stickyPosition=function(){if(0==document.getElementsByClassName("sticky-position").length)return!1;var e=f(".sticky-position"),t=e.closest(".sticky-position-container"),o=e.outerHeight(),n=parseInt(e.css("padding-top")),i=t.offset().top,s=t.offset().top+t.outerHeight()-o,a=function(){f(h).scrollTop()>i?e.addClass("fixed"):e.removeClass("fixed"),f(h).scrollTop()>s?e.removeClass("fixed").addClass("bottom"):e.removeClass("bottom")};f(h).on("resize",f.debounce(100,a)),f(u).on("scroll",f.debounce(10,a)),a(),d.onElementHeightChange(document.body,function(){i=t.offset().top-n,s=t.offset().top+t.outerHeight()-o}),d.onElementHeightChange(e[0],function(){o=e.outerHeight(),s=t.offset().top+t.outerHeight()-o}),f(h).on("resize",f.debounce(100,function(){o=e.outerHeight(),i=t.offset().top-n,s=t.offset().top+t.outerHeight()-o}))},d.stickyDisplay=function(){if(0==document.getElementsByClassName("sticky-display").length)return!1;var e=f(".sticky-display"),t=e.closest(".sticky-display-container"),o=e.outerHeight(),n=parseInt(e.css("padding-top")),i=t.offset().top-n,s=t.offset().top+t.outerHeight()-o,a=function(){f(h).scrollTop()>i&&f(h).scrollTop()<s?e.addClass("active"):e.removeClass("active")};f(h).on("resize",f.debounce(100,a)),f(u).on("scroll",f.debounce(10,a)),a(),d.onElementHeightChange(document.body,function(){i=t.offset().top-n,s=t.offset().top+t.outerHeight()-o}),d.onElementHeightChange(e[0],function(){o=e.outerHeight(),s=t.offset().top+t.outerHeight()-o})},d.popin=function(){var o=f("body");f(".link-popin").each(function(){var e=f(this),t=f(e.attr("href"));e.on("click",function(){return e.hasClass("link-popin--not-mobile")&&f(h).width()<parseInt(d.pxValue(51.9069))||(e.addClass("link-popin_active"),o.addClass("freezed"),t.addClass("active"),e.blur()),!1})}),f(".popin-closer").each(function(){var e=f(this),t=e.closest(".popin-overlay");e.on("click",function(){return e.removeClass("link-popin_active"),o.removeClass("freezed"),t.removeClass("active"),e.blur(),!1})}),f("body").keydown(function(e){27==e.which&&f(".popin-closer").trigger("click")})}}(jQuery);
